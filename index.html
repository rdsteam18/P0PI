<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>P0PI - Study Chat App</title>
  <style>
    :root {
      --primary-color: #128C7E;
      --primary-dark: #075E54;
      --accent-color: #25D366;
      --light-gray: #f0f2f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #3b4a54;
      --chat-green: #dcf8c6;
      --chat-white: #ffffff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      height: 100vh;
      background-color: #f0f2f5;
      color: #333;
    }
    
    .app-container {
      display: flex;
      height: 100vh;
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
    }
    
    /* Sidebar Styles */
    .sidebar {
      width: 35%;
      max-width: 400px;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--medium-gray);
      background-color: white;
    }
    
    .user-panel {
      background-color: var(--primary-dark);
      color: white;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-actions {
      display: flex;
      gap: 20px;
    }
    
    .user-actions i {
      font-size: 20px;
      cursor: pointer;
    }
    
    .search-container {
      background-color: var(--primary-dark);
      padding: 8px 15px;
    }
    
    .search-box {
      background-color: white;
      border-radius: 20px;
      padding: 8px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .search-box input {
      border: none;
      outline: none;
      width: 100%;
      font-size: 14px;
    }
    
    .tabs {
      display: flex;
      background-color: white;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .tab {
      flex: 1;
      text-align: center;
      padding: 15px 0;
      font-size: 15px;
      cursor: pointer;
      position: relative;
      transition: background-color 0.2s;
    }
    
    .tab.active {
      color: var(--primary-color);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 20%;
      right: 20%;
      height: 3px;
      background-color: var(--primary-color);
    }
    
    .tab:hover {
      background-color: var(--light-gray);
    }
    
    .tab-content {
      flex: 1;
      overflow-y: auto;
    }
    
    .friend-list {
      list-style: none;
    }
    
    .friend-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      gap: 15px;
      cursor: pointer;
      transition: background-color 0.2s;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .friend-item:hover {
      background-color: var(--light-gray);
    }
    
    .friend-item.active {
      background-color: #e0f2e9;
    }
    
    .friend-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      background-color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }
    
    .friend-details {
      flex: 1;
    }
    
    .friend-name {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .friend-last-msg {
      font-size: 13px;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }
    
    .friend-time {
      font-size: 12px;
      color: #666;
    }
    
    .friend-status {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
    }
    
    .unread-count {
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    /* Chat Area Styles */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: #efeae2;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23a0a0a0' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
    }
    
    .chat-header {
      background-color: var(--primary-dark);
      color: white;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chat-header-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .chat-header-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 16px;
    }
    
    .chat-header-name {
      font-weight: 500;
    }
    
    .chat-header-actions {
      display: flex;
      gap: 20px;
    }
    
    .chat-header-actions i {
      font-size: 20px;
      cursor: pointer;
    }
    
    .messages-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .message {
      max-width: 65%;
      padding: 10px 15px;
      border-radius: 8px;
      position: relative;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message-incoming {
      background-color: white;
      border-top-left-radius: 0;
      align-self: flex-start;
    }
    
    .message-outgoing {
      background-color: var(--chat-green);
      border-top-right-radius: 0;
      align-self: flex-end;
    }
    
    .message-sender {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    .message-text {
      font-size: 15px;
      line-height: 1.4;
    }
    
    .message-time {
      text-align: right;
      font-size: 11px;
      color: #666;
      margin-top: 5px;
    }
    
    .input-container {
      display: flex;
      padding: 10px 15px;
      background-color: #f0f2f5;
      align-items: center;
      gap: 10px;
    }
    
    .input-actions {
      display: flex;
      gap: 15px;
    }
    
    .input-actions i {
      font-size: 24px;
      color: var(--dark-gray);
      cursor: pointer;
    }
    
    .message-input {
      flex: 1;
      padding: 12px 20px;
      border-radius: 24px;
      border: none;
      outline: none;
      font-size: 15px;
    }
    
    .send-button {
      background-color: var(--primary-color);
      border: none;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .send-button:hover {
      background-color: var(--primary-dark);
    }
    
    .send-button i {
      font-size: 24px;
    }
    
    /* Friend Request Styles */
    .friend-request-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      gap: 15px;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .request-details {
      flex: 1;
    }
    
    .request-actions {
      display: flex;
      gap: 8px;
    }
    
    .accept-btn, .reject-btn {
      padding: 6px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    
    .accept-btn {
      background-color: var(--primary-color);
      color: white;
    }
    
    .reject-btn {
      background-color: #e0e0e0;
      color: #333;
    }
    
    /* Search Results */
    .search-results {
      padding: 10px;
    }
    
    .search-result-item {
      display: flex;
      align-items: center;
      padding: 10px;
      gap: 15px;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .search-result-name {
      flex: 1;
      font-weight: 500;
    }
    
    .add-friend-btn {
      padding: 6px 12px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        max-width: none;
      }
      
      .chat-area {
        display: none;
      }
      
      .chat-area.active {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
      }
      
      .back-button {
        display: block;
      }
    }
    
    .back-button {
      display: none;
      margin-right: 15px;
      font-size: 24px;
      cursor: pointer;
    }
  </style>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar -->
    <div class="sidebar">
      <div class="user-panel">
        <div class="user-info">
          <img src="" alt="User" id="userAvatar">
          <div>
            <div id="userName">Guest</div>
            <div style="font-size: 12px;">Online</div>
          </div>
        </div>
        <div class="user-actions">
          <i class="fas fa-circle-notch"></i>
          <i class="fas fa-message"></i>
          <i class="fas fa-ellipsis-vertical"></i>
        </div>
      </div>
      
      <div class="search-container">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Search or start new chat">
        </div>
      </div>
      
      <div class="tabs">
        <div class="tab active" data-tab="chats">Chats</div>
        <div class="tab" data-tab="requests">Requests</div>
        <div class="tab" data-tab="friends">Friends</div>
      </div>
      
      <div class="tab-content">
        <!-- Chats Tab -->
        <div id="chatsTab" class="tab-panel active">
          <ul class="friend-list" id="friendList">
            <!-- Friend chats will be populated here -->
          </ul>
        </div>
        
        <!-- Requests Tab -->
        <div id="requestsTab" class="tab-panel">
          <div id="friendRequests">
            <!-- Friend requests will be populated here -->
          </div>
        </div>
        
        <!-- Friends Tab -->
        <div id="friendsTab" class="tab-panel">
          <div id="friendsList">
            <!-- Friends list will be populated here -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- Chat Area -->
    <div class="chat-area" id="chatArea">
      <div class="chat-header">
        <div class="back-button" id="backButton">
          <i class="fas fa-arrow-left"></i>
        </div>
        <div class="chat-header-info">
          <div class="chat-header-avatar" id="chatAvatar">GC</div>
          <div>
            <div class="chat-header-name" id="chatName">Global Chat</div>
            <div style="font-size: 13px;" id="chatStatus">Online</div>
          </div>
        </div>
        <div class="chat-header-actions">
          <i class="fas fa-video"></i>
          <i class="fas fa-phone"></i>
          <i class="fas fa-ellipsis-vertical"></i>
        </div>
      </div>
      
      <div class="messages-container" id="messagesContainer">
        <!-- Messages will be populated here -->
      </div>
      
      <div class="input-container">
        <div class="input-actions">
          <i class="fas fa-plus-circle"></i>
          <i class="fas fa-paperclip"></i>
        </div>
        <input type="text" class="message-input" id="msgInput" placeholder="Type a message...">
        <button class="send-button" id="sendBtn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Mock data for demonstration
    const mockUsers = [
      { id: '1', name: 'Alex Johnson', email: 'alex@example.com', photo: '', status: 'Online', lastSeen: 'Just now' },
      { id: '2', name: 'Sarah Miller', email: 'sarah@example.com', photo: '', status: 'Online', lastSeen: '2 min ago' },
      { id: '3', name: 'Mike Thompson', email: 'mike@example.com', photo: '', status: 'Offline', lastSeen: '1 hour ago' },
      { id: '4', name: 'Emily Davis', email: 'emily@example.com', photo: '', status: 'Online', lastSeen: 'Just now' },
      { id: '5', name: 'David Wilson', email: 'david@example.com', photo: '', status: 'Offline', lastSeen: '5 hours ago' }
    ];
    
    const mockMessages = [
      { id: '1', text: 'Hey everyone! How are you doing today?', senderId: '1', senderName: 'Alex Johnson', timestamp: '10:30 AM', isGlobal: true },
      { id: '2', text: 'I\'m doing great! Working on the new project.', senderId: '2', senderName: 'Sarah Miller', timestamp: '10:32 AM', isGlobal: true },
      { id: '3', text: 'Anyone want to study together later?', senderId: '4', senderName: 'Emily Davis', timestamp: '10:35 AM', isGlobal: true },
      { id: '4', text: 'I can join around 5 PM', senderId: '1', senderName: 'Alex Johnson', timestamp: '10:36 AM', isGlobal: true },
      { id: '5', text: 'Count me in!', senderId: '2', senderName: 'Sarah Miller', timestamp: '10:37 AM', isGlobal: true },
      { id: '6', text: 'Hi Alex, did you finish the assignment?', senderId: '2', senderName: 'Sarah Miller', timestamp: '9:15 AM', isGlobal: false, receiverId: '1' },
      { id: '7', text: 'Almost done, just finishing the last section.', senderId: '1', senderName: 'Alex Johnson', timestamp: '9:20 AM', isGlobal: false, receiverId: '2' }
    ];
    
    const mockFriendRequests = [
      { id: '1', fromId: '3', fromName: 'Mike Thompson', timestamp: 'Yesterday' },
      { id: '2', fromId: '5', fromName: 'David Wilson', timestamp: '2 days ago' }
    ];
    
    // App state
    let currentUser = null;
    let selectedFriend = null;
    let activeTab = 'chats';
    let chatType = 'global'; // 'global' or 'private'
    
    // DOM Elements
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    const searchInput = document.getElementById('searchInput');
    const tabs = document.querySelectorAll('.tab');
    const friendList = document.getElementById('friendList');
    const friendRequests = document.getElementById('friendRequests');
    const friendsList = document.getElementById('friendsList');
    const chatArea = document.getElementById('chatArea');
    const chatAvatar = document.getElementById('chatAvatar');
    const chatName = document.getElementById('chatName');
    const chatStatus = document.getElementById('chatStatus');
    const messagesContainer = document.getElementById('messagesContainer');
    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');
    const backButton = document.getElementById('backButton');
    
    // Initialize the app
    function initApp() {
      // Set current user (in a real app, this would come from authentication)
      currentUser = mockUsers[0];
      userName.textContent = currentUser.name;
      userAvatar.src = currentUser.photo || '';
      userAvatar.alt = currentUser.name;
      
      // Setup event listeners
      setupEventListeners();
      
      // Render initial UI
      renderFriendList();
      renderFriendRequests();
      renderFriendsList();
      renderGlobalChat();
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Tab switching
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          switchTab(tabName);
        });
      });
      
      // Message sending
      sendBtn.addEventListener('click', sendMessage);
      msgInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      // Back button for mobile
      backButton.addEventListener('click', () => {
        chatArea.classList.remove('active');
      });
      
      // Search functionality
      searchInput.addEventListener('input', handleSearch);
    }
    
    // Switch between tabs
    function switchTab(tabName) {
      activeTab = tabName;
      
      // Update active tab UI
      tabs.forEach(tab => {
        if (tab.getAttribute('data-tab') === tabName) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Show the correct tab content
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      document.getElementById(`${tabName}Tab`).classList.add('active');
    }
    
    // Render friend list for chats
    function renderFriendList() {
      friendList.innerHTML = '';
      
      // Add global chat as the first item
      const globalChatItem = document.createElement('li');
      globalChatItem.className = 'friend-item active';
      globalChatItem.innerHTML = `
        <div class="friend-avatar">GC</div>
        <div class="friend-details">
          <div class="friend-name">Global Chat</div>
          <div class="friend-last-msg">Everyone is here</div>
        </div>
        <div class="friend-status">
          <div class="friend-time">10:37 AM</div>
        </div>
      `;
      globalChatItem.addEventListener('click', () => {
        document.querySelectorAll('.friend-item').forEach(item => {
          item.classList.remove('active');
        });
        globalChatItem.classList.add('active');
        renderGlobalChat();
        chatType = 'global';
        chatName.textContent = 'Global Chat';
        chatStatus.textContent = 'Online';
        chatAvatar.textContent = 'GC';
      });
      friendList.appendChild(globalChatItem);
      
      // Add friends
      mockUsers.slice(1).forEach(user => {
        const lastMessage = mockMessages.find(msg => 
          (msg.senderId === user.id && msg.receiverId === currentUser.id) || 
          (msg.senderId === currentUser.id && msg.receiverId === user.id)
        );
        
        const friendItem = document.createElement('li');
        friendItem.className = 'friend-item';
        friendItem.innerHTML = `
          <div class="friend-avatar">${user.name.charAt(0)}</div>
          <div class="friend-details">
            <div class="friend-name">${user.name}</div>
            <div class="friend-last-msg">${lastMessage ? lastMessage.text : 'No messages yet'}</div>
          </div>
          <div class="friend-status">
            <div class="friend-time">${user.lastSeen}</div>
            ${user.status === 'Online' ? '<div class="online-dot"></div>' : ''}
          </div>
        `;
        
        friendItem.addEventListener('click', () => {
          document.querySelectorAll('.friend-item').forEach(item => {
            item.classList.remove('active');
          });
          friendItem.classList.add('active');
          selectedFriend = user;
          renderPrivateChat();
          chatType = 'private';
          chatName.textContent = user.name;
          chatStatus.textContent = user.status;
          chatAvatar.textContent = user.name.charAt(0);
          
          // On mobile, show chat area
          if (window.innerWidth <= 768) {
            chatArea.classList.add('active');
          }
        });
        
        friendList.appendChild(friendItem);
      });
    }
    
    // Render friend requests
    function renderFriendRequests() {
      friendRequests.innerHTML = '<h3 style="padding: 15px; color: #666;">Friend Requests</h3>';
      
      if (mockFriendRequests.length === 0) {
        friendRequests.innerHTML += '<p style="padding: 15px; text-align: center; color: #666;">No friend requests</p>';
        return;
      }
      
      mockFriendRequests.forEach(request => {
        const requestItem = document.createElement('div');
        requestItem.className = 'friend-request-item';
        requestItem.innerHTML = `
          <div class="friend-avatar">${request.fromName.charAt(0)}</div>
          <div class="request-details">
            <div class="friend-name">${request.fromName}</div>
            <div style="font-size: 13px; color: #666;">${request.timestamp}</div>
          </div>
          <div class="request-actions">
            <button class="accept-btn">Accept</button>
            <button class="reject-btn">Reject</button>
          </div>
        `;
        
        // Add event listeners to buttons
        requestItem.querySelector('.accept-btn').addEventListener('click', () => {
          alert(`Accepted friend request from ${request.fromName}`);
          // In a real app, you would update the database here
        });
        
        requestItem.querySelector('.reject-btn').addEventListener('click', () => {
          alert(`Rejected friend request from ${request.fromName}`);
          // In a real app, you would update the database here
        });
        
        friendRequests.appendChild(requestItem);
      });
    }
    
    // Render friends list
    function renderFriendsList() {
      friendsList.innerHTML = '<h3 style="padding: 15px; color: #666;">Friends</h3>';
      
      mockUsers.slice(1).forEach(user => {
        const friendItem = document.createElement('div');
        friendItem.className = 'friend-request-item';
        friendItem.innerHTML = `
          <div class="friend-avatar">${user.name.charAt(0)}</div>
          <div class="request-details">
            <div class="friend-name">${user.name}</div>
            <div style="font-size: 13px; color: #666;">${user.status} • ${user.lastSeen}</div>
          </div>
          <div class="request-actions">
            <button class="accept-btn">Message</button>
          </div>
        `;
        
        friendItem.querySelector('.accept-btn').addEventListener('click', () => {
          // Switch to chats tab and select this friend
          switchTab('chats');
          setTimeout(() => {
            const friendItems = document.querySelectorAll('.friend-item');
            if (friendItems.length > 1) { // Skip global chat
              friendItems[user.id].click();
            }
          }, 100);
        });
        
        friendsList.appendChild(friendItem);
      });
    }
    
    // Render global chat
    function renderGlobalChat() {
      messagesContainer.innerHTML = '';
      const globalMessages = mockMessages.filter(msg => msg.isGlobal);
      
      globalMessages.forEach(msg => {
        const isCurrentUser = msg.senderId === currentUser.id;
        const messageElement = document.createElement('div');
        messageElement.className = `message ${isCurrentUser ? 'message-outgoing' : 'message-incoming'}`;
        
        if (!isCurrentUser) {
          messageElement.innerHTML += `<div class="message-sender">${msg.senderName}</div>`;
        }
        
        messageElement.innerHTML += `
          <div class="message-text">${msg.text}</div>
          <div class="message-time">${msg.timestamp}</div>
        `;
        
        messagesContainer.appendChild(messageElement);
      });
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // Render private chat
    function renderPrivateChat() {
      if (!selectedFriend) return;
      
      messagesContainer.innerHTML = '';
      const privateMessages = mockMessages.filter(msg => 
        (msg.senderId === currentUser.id && msg.receiverId === selectedFriend.id) ||
        (msg.senderId === selectedFriend.id && msg.receiverId === currentUser.id)
      );
      
      privateMessages.forEach(msg => {
        const isCurrentUser = msg.senderId === currentUser.id;
        const messageElement = document.createElement('div');
        messageElement.className = `message ${isCurrentUser ? 'message-outgoing' : 'message-incoming'}`;
        messageElement.innerHTML = `
          <div class="message-text">${msg.text}</div>
          <div class="message-time">${msg.timestamp}</div>
        `;
        
        messagesContainer.appendChild(messageElement);
      });
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // Send message
    function sendMessage() {
      const text = msgInput.value.trim();
      if (!text) return;
      
      const newMessage = {
        id: `msg-${Date.now()}`,
        text: text,
        senderId: currentUser.id,
        senderName: currentUser.name,
        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      };
      
      if (chatType === 'global') {
        newMessage.isGlobal = true;
        mockMessages.push(newMessage);
        renderGlobalChat();
      } else {
        newMessage.receiverId = selectedFriend.id;
        mockMessages.push(newMessage);
        renderPrivateChat();
      }
      
      // Clear input
      msgInput.value = '';
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // Handle search
    function handleSearch() {
      const searchTerm = searchInput.value.toLowerCase();
      if (!searchTerm) return;
      
      // In a real app, you would search your database
      console.log(`Searching for: ${searchTerm}`);
    }
    
    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
